<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Introduction to DOM and its Manipulation - iodide</title>
<link rel="stylesheet" type="text/css" href="https://iodide-project.github.io/master/iodide.master.css">
</head>
<body>
<script id="jsmd" type="text/jsmd">
%% meta
{
  "title": "Introduction to DOM and its Manipulation",
  "lastSaved": "2018-03-07T21:10:40.042Z",
  "lastExport": "2018-03-07T21:16:36.346Z"
}

%% md
# Introduction to DOM and its Manipulation

%% md
## What is DOM ?

The backbone of an HTML document is tags.  
According to Document Object Model (DOM), every HTML-tag is an object. These objects then can be manipulated using a scripting language such as JavaScript.

%% md
## Why should I care about DOM anyway ? 

DOM comes with a set of associated APIs through which its properties can be manipulated and configured as required. This enables us to make DOM structures (such as webpages or this notebook) interactive. Using Iodide a user can work directly on the DOM which was not quite possible using other traditional notebooks.

This notebook briefly describes how one can do manipulations on the DOM using Iodide.  
We will try to learn and understand the workings of DOM by example. First let us make a block using the **div** tag

%% md
<div id="test">
  Here we have defined a div tag with an id of test
</div>

This creates a new node in DOM tree which can be uniquely identified using the **id** *test*.

Lets add some CSS to make this look better

%% css
#test {
  padding: 1em;
  margin: 1em;
  width: 100px;
  background: #bdc3c7
}

%% md
We will now perform a very simple manipulation to the above created element using JavaScript

%% js
// Get element from the DOM tree
a = document.getElementById('test')
// Change a style property
a.style.background = "#3498db"

%% md
As you would have noticed, the background color of the box has changed without the need of re-rendering that cell. DOM APIs consits of functions similar to `getElementById` such as `querySelectorAll`, `querySelector`, `getElementsByTagName` etc. which provides us access to different elements on the DOM tree.

How about we make something more interactive.  
In the next example we are going to create a collection of boxes and add hover events to them.  
Let us write some styling code first. One for the container which we are wrapping around our boxes and the other for the box itself.

%% css
.container {
  padding: 2em;
}

.box {
  width: 100px;
  height: 100px;
  background: #8e44ad;
  display: inline-block;
  transition: ease 0.5s
}

%% md
<div class="container">
  <div class="box"></div>
  <div class="box"></div>
  <div class="box"></div>
  <div class="box"></div>
  <div class="box"></div>
  <div class="box"></div>
</div>

%% md
Here we have a static collection of boxes. We will now write some JavaScript event handlers to add effect on mouse hover over the box. Mouse hover can be decomposed into two components, `mouseover` and `mouseout`

%% js
var box = document.querySelectorAll(".box");
var mouseIn = function() {
	this.style.background = "#34495e" 
    this.style.transform = "translateY(-10px)"
};    
var mouseOut = function() {	
	this.style.background = "#8e44ad"
	this.style.transform = "translateY(0px)"
};
    
Array.from(box).forEach(function(element) {  
	element.addEventListener('mouseover', mouseIn);
    element.addEventListener('mouseout', mouseOut);
});

%% md
Try hovering over the boxes to see the effect we just created.

Lets carry what we have learnt to create a chart on the DOM

%% md
<div style="display: flex; align-items: flex-end">
  <div class="bar-chart" style="height: 40px;">4</div>
  <div class="bar-chart" style="height: 230px;">23</div>
  <div class="bar-chart" style="height: 150px;">15</div>
  <div class="bar-chart" style="height: 180px;">18</div>
  <div class="bar-chart" style="height: 90px;">9</div>
  <div class="bar-chart" style="height: 350px;">35</div>
</div>
<style>
  .bar-chart {
    font: 14px sans-serif;
    background-color: steelblue;
    padding: 3px 10px;
    width: 20px;
    margin: 1px 5px;
    color: white
  }
</style>

%% md
Hmm.. what if we could automate the creation of those divs and add more interactivity to it ?

Here comes D3 to our help. D3 is a JS library which helps us to interact with DOM based on data we have. We will quickly import it below.

%% resource
https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.8/d3.min.js

%% css
/* CSS for d3 chart components */
#bar-d3-chart {
  display: flex;
  align-items: flex-end;
}

#bar-d3-chart > div {
    font: 14px sans-serif;
    background-color: steelblue;
  	padding: 3px 10px;
    width: 20px;
    margin: 1px 5px;
    color: white
}

%% md
We will declare another node on the DOM tree on which we can mount our chart later

%% md
<div id='bar-d3-chart'></div>

%% js
d3.select('div#bar-d3-chart')
  .selectAll("div")
  .data([4, 23, 15, 18, 9, 35])
  .enter()
  .append("div")
  .style("height", (d)=> d + "0px")

%% md
How about we work with some real data now.  
Lets use GitHub's API to retrieve data of all the open source repositories by Mozilla organization hosted on GitHub.

%% js
var data;
let URL = 'https://api.github.com/orgs/mozilla/repos'
d3.json(URL, function(json) {
  data = json
})

%% md
Lets have a quick peak at our data

%% js
data

%% md
Why don't we remove some inactive repositories so that we can have a better data representation and visualization

%% js
data = data.filter(d => d.forks_count > 20)

%% md
Now we would try to plot out various parameters such as forks, stars, issues etc. for different repositories. Using d3 we will create bars, X-axis and Y-axis components and append them on the DOM.

%% js
function drawGraph() {
  var e = document.getElementById("category");
  var category = e.options[e.selectedIndex].value;
 // set the dimensions and margins of the graph
  var margin = {top: 40, right: 20, bottom: 120, left: 40},
      width = 960 - margin.left - margin.right,
      height = 600 - margin.top - margin.bottom;

  // define transition
  var t = d3.transition()
              .duration(750)
              .ease(d3.easeQuadOut);
  
  // clear Previous graph
  d3.select("#svg_graph").remove();

  // set the ranges

  // x-axis scale
  var x = d3.scaleBand()
            .range([0, width])
            .domain(data.map(function(d) { return d.name; }))
            .padding(0.05);
  // y-axis scale
  var y = d3.scaleLinear()
            .range([height, 0])
            .domain([0, d3.max(data, function(d) { return d[category]; })]);

  // create svg element
  var svg = d3.select("#chart").append("svg")
  	.attr("id","svg_graph")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .attr("viewBox", "0 0 " + (width + margin.left + margin.right) + " " + (height + margin.top + margin.bottom))
    .append("g")
    .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");

  // create x-axis
    svg.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).ticks(10))
        .selectAll("text")	
          .style("text-anchor", "end")
          .attr("dx", "-.8em")
          .attr("dy", ".15em")
          .attr("transform", "rotate(-65)");

  // create y-axis
  var yAxis = svg.append("g")
    .attr("class", "y-axis axis")
    .call(d3.axisLeft(y).ticks(10, "s"))
  .append("text")
    .attr("y", -20)
    .attr("dy", ".71em")
    .style("text-anchor", "end")
    .text("Value");

  // create bars
  var bars = svg.selectAll(".bar")
    .data(data)
    .enter().append("rect")
    .attr("class", "bar")
    .attr("x", function(d) { return x(d.name); })
    .attr("width", x.bandwidth())
    .attr("y", function(d) { return y(0); })
      .attr("height", height - y(0))
      .transition(t)
    .attr("y", function(d) { return y(d[category]); })
    .attr("height", function(d) { return height - y(d[category]); })
    .attr('fill', '#0071b9');
}

%% css
/* Adding CSS flavour for the below select and chart */

.options select {
    padding:5px;
    margin: 0;
    border-radius:4px;
    box-shadow: 0 3px 0 #ccc, 0 -1px #fff inset;
    background: #f8f8f8;
    color:#888;
    border:none;
    outline:none;
    display: inline-block;
    -webkit-appearance:none;
    -moz-appearance:none;
    appearance:none;
    cursor:pointer;
    min-width: 250px;
    text-align: center;
}

@media screen and (-webkit-min-device-pixel-ratio:0) {
    .options select {padding-right:18px}
}

.options label {position:relative}
.options label:after {
    content:'<>';
    font:11px "Consolas", monospace;
    color:#aaa;
    -webkit-transform:rotate(90deg);
    -moz-transform:rotate(90deg);
    -ms-transform:rotate(90deg);
    transform:rotate(90deg);
    right:8px; top:2px;
    padding:0 0 2px;
    border-bottom:1px solid #ddd;
    position:absolute;
    pointer-events:none;
}
.options label:before {
    content:'';
    right:6px; top:0px;
    width:20px; height:20px;
    background:#f8f8f8;
    position:absolute;
    pointer-events:none;
    display:block;
}
.options {
  text-align: center;
}
#chart {
	text-align: center;
}

%% md
<div class='options'>
  <label>
    <select onchange='drawGraph()' id="category">
            <option value="" disabled selected style="display:none;">Pick an Option</option>
            <option value="forks_count">Forks</option>
      		<option value="watchers">Watchers</option>
            <option value="stargazers_count">Stars</option>
      		<option value="size">Size</option>
            <option value="open_issues">Open Issues</option>
    </select>
  </label>
</div>
<div id="chart"></div>

%% md
## Further Resources and References

You can read more about DOM and its manipulation from the below reference links -   

[MDN Web Docs - Document Object Model (DOM)](https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model)  
[JavaScript.info - Documents](http://javascript.info/document)  
[JavaScriptKit - DOM Reference](http://www.javascriptkit.com/domref/)

%% js
</script>
<div id='page'></div>
<script src='https://iodide-project.github.io/master/iodide.master.js'></script>
</body>
</html>